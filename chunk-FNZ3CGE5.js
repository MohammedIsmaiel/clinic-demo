import{I as h,a as r,b as d,ba as l}from"./chunk-KIKRUHUI.js";var c=class a{STORAGE_KEY="clinic_patients";patients=l([]);constructor(){this.loadPatients()}loadPatients(){try{let t=localStorage.getItem(this.STORAGE_KEY);if(t){let e=JSON.parse(t);this.patients.set(e)}}catch(t){console.error("Error loading patients:",t),this.patients.set([])}}savePatients(){try{localStorage.setItem(this.STORAGE_KEY,JSON.stringify(this.patients()))}catch(t){console.error("Error saving patients:",t)}}getAllPatients(){return this.patients()}getPatientById(t){return this.patients().find(e=>e.id===t)}searchPatients(t){if(!t.trim())return this.patients();let e=t.toLowerCase();return this.patients().filter(i=>i.name.toLowerCase().includes(e)||i.phone.includes(t))}isPhoneExists(t,e){return this.patients().some(i=>i.phone===t&&i.id!==e)}createPatient(t){if(!t.name?.trim())throw new Error("Patient name is required");if(!t.phone?.trim())throw new Error("Phone number is required");if(this.isPhoneExists(t.phone))throw new Error("A patient with this phone number already exists");let e=d(r({},t),{id:"P"+Date.now(),createdAt:new Date().toISOString()});return this.patients.update(i=>[...i,e]),this.savePatients(),e}updatePatient(t,e){let i=this.patients().findIndex(s=>s.id===t);if(i===-1)throw new Error("Patient not found");if(e.phone&&this.isPhoneExists(e.phone,t))throw new Error("A patient with this phone number already exists");let n=r(r({},this.patients()[i]),e);return this.patients.update(s=>{let o=[...s];return o[i]=n,o}),this.savePatients(),n}deletePatient(t){let e=this.patients().length;return this.patients.update(i=>i.filter(n=>n.id!==t)),this.patients().length<e?(this.savePatients(),!0):!1}getPatientStats(t){return{totalVisits:0,totalPaid:0,totalOwed:0}}sortPatients(t){let e=[...this.patients()];switch(t){case"name":return e.sort((i,n)=>i.name.localeCompare(n.name));case"date":return e.sort((i,n)=>new Date(n.createdAt).getTime()-new Date(i.createdAt).getTime());case"visits":return e;default:return e}}exportPatients(){return JSON.stringify(this.patients(),null,2)}importPatients(t){try{let e=JSON.parse(t);if(!Array.isArray(e))throw new Error("Invalid data format");let i=e.filter(n=>n.id&&n.name&&n.phone&&n.createdAt);this.patients.set(i),this.savePatients()}catch(e){throw new Error("Failed to import patients: "+e)}}clearAllPatients(){confirm("Are you sure you want to delete all patients? This cannot be undone.")&&(this.patients.set([]),localStorage.removeItem(this.STORAGE_KEY))}static \u0275fac=function(e){return new(e||a)};static \u0275prov=h({token:a,factory:a.\u0275fac,providedIn:"root"})};export{c as a};
