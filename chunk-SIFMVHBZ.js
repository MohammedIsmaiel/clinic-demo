import{j as Z,k as ee,n as te}from"./chunk-H6JEJQHG.js";import{a as ie}from"./chunk-FNZ3CGE5.js";import{a as ne}from"./chunk-TNVVAGLP.js";import{B as q,G as X,I as H,K as J,L as K,M as Y,a as L,c as $,j as Q,l as R,m as O,n as W,o as G}from"./chunk-ESOQDHF6.js";import{h as U}from"./chunk-T2HTACBN.js";import{$a as N,Aa as M,Kb as A,La as y,Ma as v,N as w,Oa as V,Pa as z,Qa as c,Ra as n,S as _,Sa as i,T as h,Ta as u,Ua as D,Va as x,Wa as m,a as F,ab as B,b as k,ba as b,bb as o,cb as S,db as f,eb as j,pa as r,wb as P}from"./chunk-KIKRUHUI.js";var oe=(l,t)=>t.id;function re(l,t){if(l&1){let e=D();n(0,"div",27)(1,"div",11)(2,"div",36)(3,"h3",26),o(4,"Filter Payments"),i(),n(5,"button",37),x("click",function(){_(e);let s=m();return h(s.clearAllFilters())}),o(6," Clear All "),i()(),n(7,"div",38)(8,"div")(9,"label",39),o(10,"Time Period"),i(),n(11,"select",40),x("change",function(s){_(e);let d=m();return h(d.setDateFilter(s.target.value))}),n(12,"option",41),o(13,"All Time"),i(),n(14,"option",42),o(15,"Today"),i(),n(16,"option",43),o(17,"Last 7 Days"),i(),n(18,"option",44),o(19,"Last 30 Days"),i()()(),n(20,"div")(21,"label",39),o(22,"Start Date"),i(),n(23,"input",45),x("change",function(s){_(e);let d=m();return h(d.updateStartDate(s.target.value))}),i()(),n(24,"div")(25,"label",39),o(26,"End Date"),i(),n(27,"input",45),x("change",function(s){_(e);let d=m();return h(d.updateEndDate(s.target.value))}),i()(),n(28,"div")(29,"label",39),o(30,"Payment Method"),i(),n(31,"select",40),x("change",function(s){_(e);let d=m();return h(d.setMethodFilter(s.target.value))}),n(32,"option",41),o(33,"All Methods"),i(),n(34,"option",46),o(35,"Cash"),i(),n(36,"option",47),o(37,"Visa"),i(),n(38,"option",48),o(39,"Bank Transfer"),i()()()()()()}if(l&2){let e=m();r(11),c("value",e.dateFilter()),r(12),c("value",e.startDate()),r(4),c("value",e.endDate()),r(4),c("value",e.methodFilter())}}function le(l,t){if(l&1){let e=D();n(0,"button",49),x("click",function(){_(e);let s=m();return h(s.clearSearch())}),u(1,"lucide-icon",7),i()}if(l&2){let e=m();r(),c("img",e.XIcon)("size",18)}}function se(l,t){if(l&1){let e=D();n(0,"h3",51),o(1,"No payments found"),i(),n(2,"p",52),o(3,"Try adjusting your filters"),i(),n(4,"button",53),x("click",function(){_(e);let s=m(2);return h(s.clearAllFilters())}),o(5," Clear all filters "),i()}}function me(l,t){l&1&&(n(0,"h3",51),o(1,"No payments yet"),i(),n(2,"p",54),o(3,"Payments will appear here when recorded"),i())}function de(l,t){if(l&1&&(n(0,"div",34),u(1,"lucide-icon",50),y(2,se,6,0)(3,me,4,0),i()),l&2){let e=m();r(),c("img",e.DollarSignIcon)("size",48),r(),v(e.searchQuery()||e.dateFilter()!=="all"||e.methodFilter()!=="all"||e.startDate()||e.endDate()?2:3)}}function ce(l,t){if(l&1){let e=D();n(0,"div",73),x("click",function(){_(e);let s=m().$implicit,d=m(2);return h(d.viewPatientDetails(s))}),u(1,"lucide-icon",64),o(2),i()}if(l&2){let e=m().$implicit,a=m(2);r(),c("img",a.UserIcon)("size",14),r(),f(" ",e.patientName," ")}}function pe(l,t){if(l&1&&(n(0,"p",66)(1,"strong"),o(2,"Diagnosis:"),i(),o(3),i()),l&2){let e=m().$implicit;r(3),f(" ",e.visitDiagnosis," ")}}function ue(l,t){if(l&1&&(n(0,"p",76),o(1),i(),n(2,"p",77),o(3,"remaining"),i()),l&2){let e=m(2).$implicit,a=m(2);r(),f("",a.formatCurrency(e.visitBalance)," EGP")}}function xe(l,t){l&1&&(n(0,"p",75),o(1,"Paid"),i())}function ge(l,t){if(l&1&&(n(0,"div",68)(1,"p",74),o(2,"Visit Balance"),i(),y(3,ue,4,1)(4,xe,2,0,"p",75),i()),l&2){let e=m().$implicit;r(3),v(e.visitBalance>0?3:4)}}function ye(l,t){if(l&1&&(n(0,"span"),o(1),i()),l&2){let e=m().$implicit,a=m(2);r(),f("\u{1F4DE} ",a.formatPhone(e.patientPhone))}}function ve(l,t){if(l&1&&(n(0,"span"),o(1),i()),l&2){let e=m().$implicit,a=m(2);r(),f("Visit: ",a.formatDate(e.visitDate))}}function _e(l,t){if(l&1){let e=D();n(0,"div",55)(1,"div",2)(2,"div",56)(3,"div",57),u(4,"lucide-icon",58),i(),n(5,"div",59)(6,"div",60)(7,"h3",61),o(8),i(),n(9,"span"),o(10),i()(),n(11,"div",62)(12,"div",63),u(13,"lucide-icon",64),o(14),i(),y(15,ce,3,3,"div",65),i(),y(16,pe,4,1,"p",66),i()(),n(17,"div",67),y(18,ge,5,1,"div",68),n(19,"button",69),x("click",function(){let s=_(e).$implicit,d=m(2);return h(d.viewVisitDetails(s.visitId))}),o(20," View Visit "),i()()(),n(21,"div",70)(22,"div",71)(23,"div",72),y(24,ye,2,1,"span"),y(25,ve,2,1,"span"),n(26,"span"),o(27),i()()()()()}if(l&2){let e=t.$implicit,a=m(2);r(4),c("img",a.getMethodIcon(e.method))("size",28),r(4),f("",a.formatCurrency(e.amount)," EGP"),r(),B("px-3 py-1 rounded-full text-xs font-medium border "+a.getMethodColor(e.method)),r(),f(" ",e.method.toUpperCase()," "),r(3),c("img",a.CalendarIcon)("size",14),r(),f(" ",a.formatDateTime(e.date)," "),r(),v(e.patientName?15:-1),r(),v(e.visitDiagnosis?16:-1),r(2),v(e.visitBalance!==void 0?18:-1),r(6),v(e.patientPhone?24:-1),r(),v(e.visitDate?25:-1),r(2),f("ID: ",e.id)}}function he(l,t){if(l&1&&(n(0,"div",35),V(1,_e,28,15,"div",55,oe),i()),l&2){let e=m();r(),z(e.filteredPayments())}}var ae=class l{SearchIcon=q;FilterIcon=G;DownloadIcon=O;DollarSignIcon=R;CreditCardIcon=Q;BanknoteIcon=L;CalendarIcon=$;UserIcon=H;FileTextIcon=W;TrendingUpIcon=X;XIcon=J;visitService=w(ne);patientService=w(ie);router=w(U);searchQuery=b("");dateFilter=b("all");methodFilter=b("all");startDate=b("");endDate=b("");showFilters=b(!1);allPayments=P(()=>this.visitService.payments().map(e=>this.enrichPaymentWithDetails(e)));filteredPayments=P(()=>{let t=this.allPayments(),e=this.searchQuery().toLowerCase();e&&(t=t.filter(g=>g.patientName?.toLowerCase().includes(e)||g.patientPhone?.includes(e)||g.visitDiagnosis?.toLowerCase().includes(e)));let a=this.methodFilter();a!=="all"&&(t=t.filter(g=>g.method===a));let s=this.dateFilter(),d=new Date;s!=="all"&&(t=t.filter(g=>{let C=new Date(g.date);switch(s){case"today":return C.toDateString()===d.toDateString();case"week":let I=new Date(d);return I.setDate(I.getDate()-7),C>=I;case"month":let T=new Date(d);return T.setMonth(T.getMonth()-1),C>=T;default:return!0}}));let p=this.startDate(),E=this.endDate();return(p||E)&&(t=t.filter(g=>{let C=new Date(g.date);return!(p&&new Date(p)>C||E&&new Date(E)<C)})),t.sort((g,C)=>new Date(C.date).getTime()-new Date(g.date).getTime())});paymentStats=P(()=>{let t=this.filteredPayments(),e={totalAmount:0,totalTransactions:t.length,byMethod:{cash:0,visa:0,bank:0},averagePayment:0};return t.forEach(a=>{e.totalAmount+=a.amount,e.byMethod[a.method]+=a.amount}),e.averagePayment=e.totalTransactions>0?e.totalAmount/e.totalTransactions:0,e});enrichPaymentWithDetails(t){let e=this.visitService.getVisitById(t.visitId);if(!e)return t;let a=this.patientService.getPatientById(e.patientId),s=this.visitService.getVisitBalance(t.visitId);return k(F({},t),{patientName:a?.name,patientPhone:a?.phone,visitDate:e.date,visitDiagnosis:e.diagnosis,visitBalance:s})}onSearch(t){let e=t.target;this.searchQuery.set(e.value)}clearSearch(){this.searchQuery.set("")}toggleFilters(){this.showFilters.set(!this.showFilters())}clearAllFilters(){this.searchQuery.set(""),this.dateFilter.set("all"),this.methodFilter.set("all"),this.startDate.set(""),this.endDate.set("")}setDateFilter(t){this.dateFilter.set(t),t!=="all"&&(this.startDate.set(""),this.endDate.set(""))}setMethodFilter(t){this.methodFilter.set(t)}updateStartDate(t){this.startDate.set(t),t&&this.dateFilter.set("all")}updateEndDate(t){this.endDate.set(t),t&&this.dateFilter.set("all")}viewVisitDetails(t){this.router.navigate(["/home/visits"],{queryParams:{openVisit:t}})}viewPatientDetails(t){let e=this.visitService.getVisitById(t.visitId);e&&this.router.navigate(["/home/patients"],{queryParams:{openPatient:e.patientId}})}exportPayments(){let t=this.filteredPayments(),e=[["Date","Time","Patient","Phone","Amount","Method","Visit Date","Diagnosis","Balance"].join(","),...t.map(p=>[this.formatDate(p.date),this.formatTime(p.date),p.patientName||"Unknown",p.patientPhone||"",p.amount,p.method.toUpperCase(),p.visitDate?this.formatDate(p.visitDate):"",`"${p.visitDiagnosis||""}"`,p.visitBalance||0].join(","))].join(`
`),a=new Blob([e],{type:"text/csv"}),s=window.URL.createObjectURL(a),d=document.createElement("a");d.href=s,d.download=`payments_${new Date().toISOString().split("T")[0]}.csv`,d.click(),window.URL.revokeObjectURL(s)}getMethodIcon(t){switch(t){case"cash":return this.BanknoteIcon;case"visa":return this.CreditCardIcon;case"bank":return this.DollarSignIcon;default:return this.DollarSignIcon}}getMethodColor(t){switch(t){case"cash":return"bg-green-100 text-green-800 border-green-200";case"visa":return"bg-blue-100 text-blue-800 border-blue-200";case"bank":return"bg-purple-100 text-purple-800 border-purple-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}}formatDate(t){return new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}formatTime(t){return new Date(t).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}formatDateTime(t){return new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatPhone(t){return t.length===11?t.replace(/(\d{4})(\d{3})(\d{4})/,"$1 $2 $3"):t}formatCurrency(t){return t.toLocaleString("en-US",{minimumFractionDigits:0,maximumFractionDigits:2})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=M({type:l,selectors:[["app-payment"]],decls:81,vars:30,consts:[[1,"h-full","bg-gray-50"],[1,"bg-white","border-b","border-gray-200","px-8","py-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500","mt-1"],[1,"flex","items-center","space-x-3"],[1,"flex","items-center","space-x-2","px-4","py-2","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],[3,"img","size"],[1,"flex","items-center","space-x-2","px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[1,"px-8","py-6"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-6"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","p-6"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","text-gray-600"],[1,"w-10","h-10","rounded-full","bg-green-100","flex","items-center","justify-center"],[1,"text-green-600",3,"img","size"],[1,"text-3xl","font-bold","text-gray-900"],[1,"w-10","h-10","rounded-full","bg-blue-100","flex","items-center","justify-center"],[1,"text-blue-600",3,"img","size"],[1,"w-10","h-10","rounded-full","bg-purple-100","flex","items-center","justify-center"],[1,"text-purple-600",3,"img","size"],[1,"w-10","h-10","rounded-full","bg-orange-100","flex","items-center","justify-center"],[1,"text-orange-600",3,"img","size"],[1,"space-y-1"],[1,"flex","justify-between","text-sm"],[1,"text-gray-600"],[1,"font-semibold","text-gray-900"],[1,"px-8","pb-6"],[1,"relative"],[1,"absolute","left-4","top-1/2","transform","-translate-y-1/2","text-gray-400",3,"img","size"],["type","text","placeholder","Search by patient name, phone, or diagnosis...",1,"w-full","pl-12","pr-12","py-3","border","border-gray-300","rounded-xl","focus:outline-none","focus:ring-2","focus:ring-blue-500","bg-white","shadow-sm",3,"input","value"],[1,"absolute","right-4","top-1/2","transform","-translate-y-1/2","text-gray-400","hover:text-gray-600"],[1,"px-8","pb-8"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","overflow-hidden"],[1,"text-center","py-16"],[1,"divide-y","divide-gray-200"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-sm","text-blue-600","hover:text-blue-700","font-medium",3,"click"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"block","text-sm","font-medium","text-gray-700","mb-2"],[1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"change","value"],["value","all"],["value","today"],["value","week"],["value","month"],["type","date",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"change","value"],["value","cash"],["value","visa"],["value","bank"],[1,"absolute","right-4","top-1/2","transform","-translate-y-1/2","text-gray-400","hover:text-gray-600",3,"click"],[1,"mx-auto","text-gray-400","mb-4",3,"img","size"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-500","mb-4"],[1,"text-blue-600","hover:text-blue-700","font-medium",3,"click"],[1,"text-gray-500"],[1,"p-6","hover:bg-gray-50","transition-colors"],[1,"flex","items-center","space-x-4","flex-1"],[1,"w-14","h-14","rounded-full","bg-gradient-to-br","from-green-500","to-emerald-600","flex","items-center","justify-center"],[1,"text-white",3,"img","size"],[1,"flex-1"],[1,"flex","items-center","space-x-3","mb-2"],[1,"text-xl","font-bold","text-gray-900"],[1,"flex","items-center","space-x-6","text-sm","text-gray-600"],[1,"flex","items-center"],[1,"mr-1.5",3,"img","size"],[1,"flex","items-center","cursor-pointer","hover:text-blue-600"],[1,"mt-2","text-sm","text-gray-700","line-clamp-1"],[1,"flex","items-center","space-x-6"],[1,"text-right"],[1,"px-4","py-2","border","border-blue-600","text-blue-600","rounded-lg","hover:bg-blue-50","transition-colors","font-medium","text-sm",3,"click"],[1,"mt-4","pt-4","border-t","border-gray-100"],[1,"flex","items-center","justify-between","text-xs","text-gray-500"],[1,"flex","items-center","space-x-4"],[1,"flex","items-center","cursor-pointer","hover:text-blue-600",3,"click"],[1,"text-sm","text-gray-500"],[1,"text-lg","font-bold","text-green-600"],[1,"text-lg","font-bold","text-red-600"],[1,"text-xs","text-gray-500"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),o(5,"Payments"),i(),n(6,"p",4),o(7),i()(),n(8,"div",5)(9,"button",6),x("click",function(){return a.toggleFilters()}),u(10,"lucide-icon",7),n(11,"span"),o(12,"Filters"),i()(),n(13,"button",8),x("click",function(){return a.exportPayments()}),u(14,"lucide-icon",7),n(15,"span"),o(16,"Export CSV"),i()()()()(),n(17,"div",9)(18,"div",10)(19,"div",11)(20,"div",12)(21,"p",13),o(22,"Total Collected"),i(),n(23,"div",14),u(24,"lucide-icon",15),i()(),n(25,"p",16),o(26),i(),n(27,"p",4),o(28,"EGP"),i()(),n(29,"div",11)(30,"div",12)(31,"p",13),o(32,"Transactions"),i(),n(33,"div",17),u(34,"lucide-icon",18),i()(),n(35,"p",16),o(36),i(),n(37,"p",4),o(38,"payments"),i()(),n(39,"div",11)(40,"div",12)(41,"p",13),o(42,"Average Payment"),i(),n(43,"div",19),u(44,"lucide-icon",20),i()(),n(45,"p",16),o(46),i(),n(47,"p",4),o(48,"EGP"),i()(),n(49,"div",11)(50,"div",12)(51,"p",13),o(52,"By Method"),i(),n(53,"div",21),u(54,"lucide-icon",22),i()(),n(55,"div",23)(56,"div",24)(57,"span",25),o(58,"Cash:"),i(),n(59,"span",26),o(60),i()(),n(61,"div",24)(62,"span",25),o(63,"Visa:"),i(),n(64,"span",26),o(65),i()(),n(66,"div",24)(67,"span",25),o(68,"Bank:"),i(),n(69,"span",26),o(70),i()()()()()(),y(71,re,40,4,"div",27),n(72,"div",27)(73,"div",28),u(74,"lucide-icon",29),n(75,"input",30),x("input",function(d){return a.onSearch(d)}),i(),y(76,le,2,2,"button",31),i()(),n(77,"div",32)(78,"div",33),y(79,de,4,3,"div",34)(80,he,3,0,"div",35),i()()()),e&2&&(r(7),j(" ",a.filteredPayments().length," payment",a.filteredPayments().length!==1?"s":""," found "),r(2),N("bg-blue-50",a.showFilters())("text-blue-600",a.showFilters()),r(),c("img",a.FilterIcon)("size",20),r(4),c("img",a.DownloadIcon)("size",20),r(10),c("img",a.TrendingUpIcon)("size",20),r(2),S(a.formatCurrency(a.paymentStats().totalAmount)),r(8),c("img",a.FileTextIcon)("size",20),r(2),S(a.paymentStats().totalTransactions),r(8),c("img",a.DollarSignIcon)("size",20),r(2),S(a.formatCurrency(a.paymentStats().averagePayment)),r(8),c("img",a.CreditCardIcon)("size",20),r(6),S(a.formatCurrency(a.paymentStats().byMethod.cash)),r(5),S(a.formatCurrency(a.paymentStats().byMethod.visa)),r(5),S(a.formatCurrency(a.paymentStats().byMethod.bank)),r(),v(a.showFilters()?71:-1),r(3),c("img",a.SearchIcon)("size",20),r(),c("value",a.searchQuery()),r(),v(a.searchQuery()?76:-1),r(3),v(a.filteredPayments().length===0?79:80))},dependencies:[A,te,Z,ee,Y,K],encapsulation:2})};export{ae as PaymentComponent};
