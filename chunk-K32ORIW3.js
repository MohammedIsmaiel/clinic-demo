import{b as Q,c as U,e as X}from"./chunk-XVAHRLWD.js";import{d as de,e as pe,g as ce,j as me,k as ue,n as xe}from"./chunk-H6JEJQHG.js";import{a as ve}from"./chunk-FNZ3CGE5.js";import{a as _e}from"./chunk-TNVVAGLP.js";import{B as ne,F as ae,I as oe,K as re,L as le,M as se,c as G,g as H,h as W,i as Z,l as J,n as K,v as Y,w as ee,x as te,y as ie}from"./chunk-ESOQDHF6.js";import{f as R,h as q}from"./chunk-T2HTACBN.js";import{$a as I,Aa as L,Kb as j,La as f,Ma as C,N as w,Oa as F,Pa as z,Qa as x,Ra as i,S as v,Sa as n,T as g,Ta as b,Ua as S,Va as _,Wa as m,a as B,ab as $,b as T,ba as P,bb as r,cb as c,db as h,eb as V,jb as N,kb as D,lb as M,ob as A,pa as t,rb as d,sb as p,tb as O,wb as k}from"./chunk-KIKRUHUI.js";var be=o=>({count:o}),ye=o=>({amount:o}),fe=(o,a)=>a.id;function Se(o,a){if(o&1){let e=S();i(0,"button",22),_("click",function(){v(e);let l=m();return g(l.clearSearch())}),b(1,"lucide-icon",6),n()}if(o&2){let e=m();t(),x("img",e.XIcon)("size",18)}}function Pe(o,a){if(o&1){let e=S();i(0,"h3",24),r(1),d(2,"translate"),n(),i(3,"p",25),r(4),d(5,"translate"),n(),i(6,"button",26),_("click",function(){v(e);let l=m(2);return g(l.clearSearch())}),r(7),d(8,"translate"),n()}o&2&&(t(),c(p(2,3,"patient.emptyState.noSearchResults.title")),t(3),c(p(5,5,"patient.emptyState.noSearchResults.description")),t(3),h(" ",p(8,7,"patient.buttons.clearSearch")," "))}function Ee(o,a){if(o&1){let e=S();i(0,"h3",24),r(1),d(2,"translate"),n(),i(3,"p",25),r(4),d(5,"translate"),n(),i(6,"button",27),_("click",function(){v(e);let l=m(2);return g(l.openAddModal())}),r(7),d(8,"translate"),n()}o&2&&(t(),h("",p(2,3,"patient.emptyState.noPatients.title")," "),t(3),c(p(5,5,"patient.emptyState.noPatients.description")),t(3),h(" ",p(8,7,"patient.buttons.registerPatient")," "))}function we(o,a){if(o&1&&(i(0,"div",19),b(1,"lucide-icon",23),f(2,Pe,9,9)(3,Ee,9,9),n()),o&2){let e=m();t(),x("img",e.UserIcon)("size",48),t(),C(e.searchQuery()?2:3)}}function Ie(o,a){if(o&1&&(i(0,"span",35),r(1),d(2,"translate"),n()),o&2){let e=m().$implicit;t(),V("",p(2,2,"patient.table.age"),": ",e.age)}}function Ve(o,a){if(o&1&&(i(0,"span",36),r(1),d(2,"translate"),n()),o&2){let e=m().$implicit;t(),c(p(2,1,"patient.form.genderOptions."+e.gender))}}function Be(o,a){if(o&1&&(i(0,"div",37),b(1,"lucide-icon",43),i(2,"span",44),r(3),n()()),o&2){let e=m().$implicit,s=m(2);t(),x("img",s.AlertCircleIcon)("size",14),t(2),c(e.notes)}}function Te(o,a){if(o&1){let e=S();i(0,"div",29),_("click",function(){let l=v(e).$implicit,u=m(2);return g(u.openDetailsModal(l))}),i(1,"div",2)(2,"div",8)(3,"div",30),r(4),n(),i(5,"div")(6,"h3",31),r(7),n(),i(8,"div",32)(9,"div",33),b(10,"lucide-icon",34),r(11),n(),f(12,Ie,3,4,"span",35),f(13,Ve,3,3,"span",36),n(),f(14,Be,4,3,"div",37),n()(),i(15,"div",38)(16,"div",39)(17,"p",35),r(18),d(19,"translate"),n(),i(20,"p",40),r(21),n()(),i(22,"button",41),d(23,"translate"),_("click",function(l){let u=v(e).$implicit,y=m(2);return l.stopPropagation(),g(y.openEditModal(u))}),b(24,"lucide-icon",6),n(),i(25,"button",42),d(26,"translate"),_("click",function(l){let u=v(e).$implicit,y=m(2);return l.stopPropagation(),g(y.onDelete(u))}),b(27,"lucide-icon",6),n()()()()}if(o&2){let e=a.$implicit,s=m(2);t(4),h(" ",s.getInitials(e.name)," "),t(3),c(e.name),t(3),x("img",s.PhoneIcon)("size",14),t(),h(" ",s.formatPhone(e.phone)," "),t(),C(e.age?12:-1),t(),C(e.gender?13:-1),t(),C(e.notes?14:-1),t(4),c(p(19,16,"patient.table.registered")),t(3),c(s.formatDate(e.createdAt)),t(),x("title",p(23,18,"patient.tooltips.editPatient")),t(2),x("img",s.Edit2Icon)("size",18),t(),x("title",p(26,20,"patient.tooltips.deletePatient")),t(2),x("img",s.Trash2Icon)("size",18)}}function De(o,a){if(o&1&&(i(0,"div",20),F(1,Te,28,22,"div",28,fe),n()),o&2){let e=m();t(),z(e.filteredPatients())}}function Me(o,a){if(o&1&&(i(0,"p",53),r(1),n()),o&2){let e=m(2);t(),c(e.formErrors().name)}}function ke(o,a){if(o&1&&(i(0,"p",53),r(1),n()),o&2){let e=m(2);t(),c(e.formErrors().phone)}}function Fe(o,a){if(o&1&&(i(0,"p",53),r(1),n()),o&2){let e=m(2);t(),c(e.formErrors().age)}}function ze(o,a){if(o&1&&(i(0,"div",62)(1,"p",66),r(2),n()()),o&2){let e=m(2);t(2),c(e.formErrors().submit)}}function Ne(o,a){if(o&1){let e=S();i(0,"div",21)(1,"div",45)(2,"div",46)(3,"h2",47),r(4),d(5,"translate"),n(),i(6,"button",48),_("click",function(){v(e);let l=m();return g(l.closeAddModal())}),b(7,"lucide-icon",6),n()(),i(8,"form",49),_("submit",function(l){v(e);let u=m();return l.preventDefault(),g(u.onSubmitNew())}),i(9,"div")(10,"label",50),r(11),d(12,"translate"),i(13,"span",51),r(14),d(15,"translate"),n()(),i(16,"input",52),d(17,"translate"),_("input",function(l){v(e);let u=m();return g(u.updateFormField("name",l.target.value))}),n(),f(18,Me,2,1,"p",53),n(),i(19,"div")(20,"label",50),r(21),d(22,"translate"),i(23,"span",51),r(24),d(25,"translate"),n()(),i(26,"input",54),d(27,"translate"),_("input",function(l){v(e);let u=m();return g(u.updateFormField("phone",l.target.value))}),n(),f(28,ke,2,1,"p",53),n(),i(29,"div",55)(30,"div")(31,"label",50),r(32),d(33,"translate"),n(),i(34,"input",56),d(35,"translate"),_("input",function(l){v(e);let u=m();return g(u.updateFormField("age",l.target.value?+l.target.value:void 0))}),n(),f(36,Fe,2,1,"p",53),n(),i(37,"div")(38,"label",50),r(39),d(40,"translate"),n(),i(41,"select",57),_("change",function(l){v(e);let u=m();return g(u.updateFormField("gender",l.target.value))}),i(42,"option",58),r(43),d(44,"translate"),n(),i(45,"option",59),r(46),d(47,"translate"),n(),i(48,"option",60),r(49),d(50,"translate"),n()()()(),i(51,"div")(52,"label",50),r(53),d(54,"translate"),n(),i(55,"textarea",61),d(56,"translate"),_("input",function(l){v(e);let u=m();return g(u.updateFormField("notes",l.target.value))}),r(57,"          "),n()(),f(58,ze,3,1,"div",62),i(59,"div",63)(60,"button",64),_("click",function(){v(e);let l=m();return g(l.closeAddModal())}),r(61),d(62,"translate"),n(),i(63,"button",65),r(64),d(65,"translate"),n()()()()()}if(o&2){let e=m();t(4),c(p(5,34,"patient.modal.addTitle")),t(3),x("img",e.XIcon)("size",24),t(4),h(" ",p(12,36,"patient.form.fullName")," "),t(3),c(p(15,38,"patient.form.required")),t(2),I("border-red-500",e.formErrors().name),x("value",e.formData().name)("placeholder",p(17,40,"patient.form.placeholders.name")),t(2),C(e.formErrors().name?18:-1),t(3),h(" ",p(22,42,"patient.form.phoneNumber")," "),t(3),c(p(25,44,"patient.form.required")),t(2),I("border-red-500",e.formErrors().phone),x("value",e.formData().phone)("placeholder",p(27,46,"patient.form.placeholders.phone")),t(2),C(e.formErrors().phone?28:-1),t(4),c(p(33,48,"patient.form.age")),t(2),I("border-red-500",e.formErrors().age),x("value",e.formData().age||"")("placeholder",p(35,50,"patient.form.placeholders.age")),t(2),C(e.formErrors().age?36:-1),t(3),c(p(40,52,"patient.form.gender")),t(2),x("value",e.formData().gender),t(2),c(p(44,54,"patient.form.genderOptions.select")),t(3),c(p(47,56,"patient.form.genderOptions.male")),t(3),c(p(50,58,"patient.form.genderOptions.female")),t(4),h(" ",p(54,60,"patient.form.notes")," "),t(2),x("value",e.formData().notes)("placeholder",p(56,62,"patient.form.placeholders.notes")),t(3),C(e.formErrors().submit?58:-1),t(3),h(" ",p(62,64,"patient.buttons.cancel")," "),t(3),h(" ",p(65,66,"patient.buttons.registerPatient")," ")}}function Ae(o,a){if(o&1&&(i(0,"p",53),r(1),n()),o&2){let e=m(2);t(),c(e.formErrors().name)}}function Oe(o,a){if(o&1&&(i(0,"p",53),r(1),n()),o&2){let e=m(2);t(),c(e.formErrors().phone)}}function Le(o,a){if(o&1&&(i(0,"div",62)(1,"p",66),r(2),n()()),o&2){let e=m(2);t(2),c(e.formErrors().submit)}}function $e(o,a){if(o&1){let e=S();i(0,"div",21)(1,"div",45)(2,"div",46)(3,"h2",47),r(4),d(5,"translate"),n(),i(6,"button",48),_("click",function(){v(e);let l=m();return g(l.closeEditModal())}),b(7,"lucide-icon",6),n()(),i(8,"form",49),_("submit",function(l){v(e);let u=m();return l.preventDefault(),g(u.onSubmitEdit())}),i(9,"div")(10,"label",50),r(11),d(12,"translate"),i(13,"span",51),r(14),d(15,"translate"),n()(),i(16,"input",67),_("input",function(l){v(e);let u=m();return g(u.updateFormField("name",l.target.value))}),n(),f(17,Ae,2,1,"p",53),n(),i(18,"div")(19,"label",50),r(20),d(21,"translate"),i(22,"span",51),r(23),d(24,"translate"),n()(),i(25,"input",68),_("input",function(l){v(e);let u=m();return g(u.updateFormField("phone",l.target.value))}),n(),f(26,Oe,2,1,"p",53),n(),i(27,"div",55)(28,"div")(29,"label",50),r(30),d(31,"translate"),n(),i(32,"input",69),_("input",function(l){v(e);let u=m();return g(u.updateFormField("age",l.target.value?+l.target.value:void 0))}),n()(),i(33,"div")(34,"label",50),r(35),d(36,"translate"),n(),i(37,"select",57),_("change",function(l){v(e);let u=m();return g(u.updateFormField("gender",l.target.value))}),i(38,"option",58),r(39),d(40,"translate"),n(),i(41,"option",59),r(42),d(43,"translate"),n(),i(44,"option",60),r(45),d(46,"translate"),n()()()(),i(47,"div")(48,"label",50),r(49),d(50,"translate"),n(),i(51,"textarea",70),_("input",function(l){v(e);let u=m();return g(u.updateFormField("notes",l.target.value))}),r(52,"          "),n()(),f(53,Le,3,1,"div",62),i(54,"div",63)(55,"button",64),_("click",function(){v(e);let l=m();return g(l.closeEditModal())}),r(56),d(57,"translate"),n(),i(58,"button",65),r(59),d(60,"translate"),n()()()()()}if(o&2){let e=m();t(4),c(p(5,27,"patient.modal.editTitle")),t(3),x("img",e.XIcon)("size",24),t(4),h(" ",p(12,29,"patient.form.fullName")," "),t(3),c(p(15,31,"patient.form.required")),t(2),I("border-red-500",e.formErrors().name),x("value",e.formData().name),t(),C(e.formErrors().name?17:-1),t(3),h(" ",p(21,33,"patient.form.phoneNumber")," "),t(3),c(p(24,35,"patient.form.required")),t(2),I("border-red-500",e.formErrors().phone),x("value",e.formData().phone),t(),C(e.formErrors().phone?26:-1),t(4),c(p(31,37,"patient.form.age")),t(2),x("value",e.formData().age||""),t(3),c(p(36,39,"patient.form.gender")),t(2),x("value",e.formData().gender),t(2),c(p(40,41,"patient.form.genderOptions.select")),t(3),c(p(43,43,"patient.form.genderOptions.male")),t(3),c(p(46,45,"patient.form.genderOptions.female")),t(4),h(" ",p(50,47,"patient.form.notes")," "),t(2),x("value",e.formData().notes),t(2),C(e.formErrors().submit?53:-1),t(3),h(" ",p(57,49,"patient.buttons.cancel")," "),t(3),h(" ",p(60,51,"patient.buttons.saveChanges")," ")}}function je(o,a){if(o&1&&(i(0,"div")(1,"p",35),r(2),d(3,"translate"),n(),i(4,"p",77),r(5),d(6,"translate"),n()()),o&2){let e=m(2);t(2),c(p(3,3,"patient.form.age")),t(3),V("",e.selectedPatient().age," ",p(6,5,"patient.details.years"))}}function Re(o,a){if(o&1&&(i(0,"div")(1,"p",35),r(2),d(3,"translate"),n(),i(4,"p",85),r(5),d(6,"translate"),n()()),o&2){let e=m(2);t(2),c(p(3,2,"patient.form.gender")),t(3),c(p(6,4,"patient.form.genderOptions."+e.selectedPatient().gender))}}function qe(o,a){if(o&1&&(i(0,"div",90)(1,"span",35),r(2),d(3,"translate"),n(),i(4,"p",77),r(5),n()()),o&2){let e=m(3);t(2),c(p(3,2,"patient.details.lastVisit")),t(3),c(e.formatDate(e.selectedPatientStats().lastVisit??""))}}function Qe(o,a){if(o&1&&(i(0,"div",76)(1,"div",86)(2,"span",35),r(3),d(4,"translate"),n(),i(5,"span",87),r(6),n()(),i(7,"div",86)(8,"span",35),r(9),d(10,"translate"),n(),i(11,"span",88),r(12),n()(),i(13,"div",86)(14,"span",35),r(15),d(16,"translate"),n(),i(17,"span",89),r(18),n()(),f(19,qe,6,4,"div",90),n()),o&2){let e=m(2);t(3),c(p(4,7,"patient.details.totalVisits")),t(3),c(e.selectedPatientStats().totalVisits),t(3),c(p(10,9,"patient.details.totalPaid")),t(3),h("",e.selectedPatientStats().totalPaid," EGP"),t(3),c(p(16,11,"patient.details.totalOwed")),t(3),h("",e.selectedPatientStats().totalOwed," EGP"),t(),C(e.selectedPatientStats().lastVisit?19:-1)}}function Ue(o,a){if(o&1&&(i(0,"div",78)(1,"div",91),b(2,"lucide-icon",92),i(3,"div")(4,"h4",93),r(5),d(6,"translate"),n(),i(7,"p",94),r(8),n()()()()),o&2){let e=m(2);t(2),x("img",e.AlertCircleIcon)("size",20),t(3),c(p(6,4,"patient.details.medicalNotes")),t(3),c(e.selectedPatient().notes)}}function Xe(o,a){if(o&1){let e=S();i(0,"div",84),b(1,"lucide-icon",95),i(2,"p",96),r(3),d(4,"translate"),n(),i(5,"p",97),r(6),d(7,"translate"),n(),i(8,"button",98),_("click",function(){v(e);let l=m(2);return g(l.createVisit(l.selectedPatient()))}),r(9),d(10,"translate"),n()()}if(o&2){let e=m(2);t(),x("img",e.FileTextIcon)("size",48),t(2),c(p(4,5,"patient.details.noVisits.title")),t(3),c(p(7,7,"patient.details.noVisits.description")),t(3),h(" ",p(10,9,"patient.buttons.createFirstVisit")," ")}}function Ge(o,a){if(o&1&&(i(0,"p",106),r(1),n()),o&2){let e=m().$implicit;t(),c(e.diagnosis)}}function He(o,a){if(o&1&&(i(0,"p",109),r(1),d(2,"translate"),n()),o&2){m();let e=M(0);t(),h("",O(2,1,"patient.visit.owed",A(4,ye,e))," ")}}function We(o,a){o&1&&(i(0,"p",110),r(1),d(2,"translate"),n()),o&2&&(t(),c(p(2,1,"patient.visit.paidInFull")))}function Ze(o,a){if(o&1&&(i(0,"span",112),b(1,"lucide-icon",34),r(2),d(3,"translate"),n()),o&2){m();let e=M(23),s=m(3);t(),x("img",s.FileTextIcon)("size",12),t(),V(" ",e.length," ",p(3,4,e.length===1?"patient.visit.procedure":"patient.visit.procedure_plural")," ")}}function Je(o,a){if(o&1&&(i(0,"span",112),b(1,"lucide-icon",34),r(2),d(3,"translate"),n()),o&2){m();let e=M(24),s=m(3);t(),x("img",s.DollarSignIcon)("size",12),t(),V(" ",e.length," ",p(3,4,e.length===1?"patient.visit.payment":"patient.visit.payment_plural")," ")}}function Ke(o,a){if(o&1&&(i(0,"span",112),b(1,"lucide-icon",34),r(2),d(3,"translate"),n()),o&2){let e=m(4);t(),x("img",e.FileTextIcon)("size",12),t(),h(" ",p(3,3,"patient.visit.prescription")," ")}}function Ye(o,a){if(o&1){let e=S();N(0),i(1,"div",100),_("click",function(){let l=v(e).$implicit,u=m(3);return g(u.viewVisitDetails(l))}),i(2,"div",101)(3,"div",102)(4,"div",103),b(5,"lucide-icon",104),n(),i(6,"div")(7,"div",105)(8,"span"),r(9),d(10,"translate"),n(),i(11,"span",35),r(12),n()(),f(13,Ge,2,1,"p",106),n()(),i(14,"div",107)(15,"p",35),r(16),d(17,"translate"),n(),i(18,"p",108),r(19),n(),f(20,He,3,6,"p",109)(21,We,3,3,"p",110),n()(),i(22,"div",111),N(23)(24),f(25,Ze,4,6,"span",112),f(26,Je,4,6,"span",112),f(27,Ke,4,5,"span",112),n()()}if(o&2){let e=a.$implicit,s=m(3),l=D(s.getVisitBalance(e.id));t(5),x("img",s.getVisitStatusIcon(e.status))("size",20),t(3),$("px-2 py-1 rounded-full text-xs font-medium "+s.getVisitStatusColor(e.status)),t(),h(" ",p(10,14,"patient.visit.status."+e.status)," "),t(3),c(s.formatDateTime(e.date)),t(),C(e.diagnosis?13:-1),t(3),c(p(17,16,"patient.visit.totalCost")),t(3),h("",e.totalCost," EGP"),t(),C(l>0?20:e.totalCost>0?21:-1),t(3);let u=D(s.visitService.getVisitProcedures(e.id));t();let y=D(s.visitService.getVisitPayments(e.id)),E=s.visitService.getVisitPrescription(e.id);t(),C(u.length>0?25:-1),t(),C(y.length>0?26:-1),t(),C(E?27:-1)}}function et(o,a){if(o&1&&(i(0,"div",76),F(1,Ye,28,20,"div",99,fe),n()),o&2){let e=m(2);t(),z(e.selectedPatientVisits())}}function tt(o,a){if(o&1){let e=S();i(0,"div",21)(1,"div",71)(2,"div",46)(3,"div")(4,"h2",3),r(5),n(),i(6,"p",4),r(7),d(8,"translate"),n()(),i(9,"button",48),_("click",function(){v(e);let l=m();return g(l.closeDetailsModal())}),b(10,"lucide-icon",6),n()(),i(11,"div",72)(12,"div",73)(13,"div",74)(14,"h3",75),r(15),d(16,"translate"),n(),i(17,"div",76)(18,"div")(19,"p",35),r(20),d(21,"translate"),n(),i(22,"p",77),r(23),n()(),i(24,"div")(25,"p",35),r(26),d(27,"translate"),n(),i(28,"p",77),r(29),n()(),f(30,je,7,7,"div"),f(31,Re,7,6,"div"),i(32,"div")(33,"p",35),r(34),d(35,"translate"),n(),i(36,"p",77),r(37),n()()()(),i(38,"div",74)(39,"h3",75),r(40),d(41,"translate"),n(),f(42,Qe,20,13,"div",76),n()(),f(43,Ue,9,6,"div",78),i(44,"div",79)(45,"button",80),_("click",function(){v(e);let l=m();return g(l.createVisit(l.selectedPatient()))}),b(46,"lucide-icon",6),i(47,"span"),r(48),d(49,"translate"),n()(),i(50,"button",81),_("click",function(){v(e);let l=m();return l.closeDetailsModal(),g(l.openEditModal(l.selectedPatient()))}),b(51,"lucide-icon",6),i(52,"span"),r(53),d(54,"translate"),n()(),i(55,"button",82),_("click",function(){v(e);let l=m();return g(l.onDelete(l.selectedPatient()))}),b(56,"lucide-icon",6),i(57,"span"),r(58),d(59,"translate"),n()()(),i(60,"div",83)(61,"h3",75),r(62),d(63,"translate"),n(),f(64,Xe,11,11,"div",84)(65,et,3,0,"div",76),n()()()()}if(o&2){let e=m();t(5),c(e.selectedPatient().name),t(2),V("",p(8,28,"patient.modal.patientId"),": ",e.selectedPatient().id," "),t(3),x("img",e.XIcon)("size",24),t(5),c(p(16,30,"patient.details.personalInfo")),t(5),c(p(21,32,"patient.form.fullName")),t(3),c(e.selectedPatient().name),t(3),c(p(27,34,"patient.form.phoneNumber")),t(3),c(e.formatPhone(e.selectedPatient().phone)),t(),C(e.selectedPatient().age?30:-1),t(),C(e.selectedPatient().gender?31:-1),t(3),c(p(35,36,"patient.table.registered")),t(3),c(e.formatDate(e.selectedPatient().createdAt)),t(3),c(p(41,38,"patient.details.financialSummary")),t(2),C(e.selectedPatientStats()?42:-1),t(),C(e.selectedPatient().notes?43:-1),t(3),x("img",e.PlusIcon)("size",18),t(2),c(p(49,40,"patient.buttons.createVisit")),t(3),x("img",e.Edit2Icon)("size",18),t(2),c(p(54,42,"patient.buttons.editPatient")),t(3),x("img",e.Trash2Icon)("size",18),t(2),c(p(59,44,"patient.buttons.deletePatient")),t(4),c(p(63,46,"patient.details.visitHistory")),t(2),C(e.selectedPatientVisits().length===0?64:65)}}var ge=class o{SearchIcon=ne;PlusIcon=ie;Edit2Icon=Y;Trash2Icon=ae;PhoneIcon=ee;CalendarIcon=G;UserIcon=oe;AlertCircleIcon=H;XIcon=re;FileTextIcon=K;DollarSignIcon=J;ClockIcon=Z;CheckCircleIcon=W;PlayIcon=te;searchQuery=P("");showAddModal=P(!1);showDetailsModal=P(!1);showEditModal=P(!1);selectedPatient=P(null);sortBy=P("date");formData=P({name:"",phone:"",age:void 0,gender:"",notes:""});formErrors=P({});filteredPatients=k(()=>{let a=this.searchQuery(),e=this.patientService.patients();if(!a.trim())return this.sortPatients(e);let s=this.patientService.searchPatients(a);return this.sortPatients(s)});selectedPatientStats=k(()=>{let a=this.selectedPatient();if(!a)return null;let e=this.visitService.getVisitsByPatient(a.id),s=e.reduce((y,E)=>y+this.visitService.getVisitPayments(E.id).reduce((Ce,he)=>Ce+he.amount,0),0),l=e.reduce((y,E)=>y+this.visitService.getVisitBalance(E.id),0),u=e.length>0?e[0].date:void 0;return{totalVisits:e.length,totalPaid:s,totalOwed:l,lastVisit:u}});selectedPatientVisits=k(()=>{let a=this.selectedPatient();return a?this.visitService.getVisitsByPatient(a.id):[]});patientService=w(ve);visitService=w(_e);router=w(q);translate=w(Q);route=w(R);ngOnInit(){this.route.queryParams.subscribe(a=>{if(a.openPatient){let e=this.patientService.getPatientById(a.openPatient);e&&this.openDetailsModal(e)}})}sortPatients(a){let e=[...a];switch(this.sortBy()){case"name":return e.sort((l,u)=>l.name.localeCompare(u.name));case"date":return e.sort((l,u)=>new Date(u.createdAt).getTime()-new Date(l.createdAt).getTime());case"visits":return e.sort((l,u)=>{let y=this.visitService.getVisitsByPatient(l.id).length;return this.visitService.getVisitsByPatient(u.id).length-y});default:return e}}setSortBy(a){this.sortBy.set(a)}onSearch(a){let e=a.target;this.searchQuery.set(e.value)}clearSearch(){this.searchQuery.set("")}openAddModal(){this.resetForm(),this.showAddModal.set(!0)}closeAddModal(){this.showAddModal.set(!1),this.resetForm()}openDetailsModal(a){this.selectedPatient.set(a),this.showDetailsModal.set(!0)}closeDetailsModal(){this.showDetailsModal.set(!1),this.selectedPatient.set(null)}openEditModal(a){this.selectedPatient.set(a),this.formData.set({name:a.name,phone:a.phone,age:a.age,gender:a.gender,notes:a.notes}),this.showEditModal.set(!0)}closeEditModal(){this.showEditModal.set(!1),this.selectedPatient.set(null),this.resetForm()}resetForm(){this.formData.set({name:"",phone:"",age:void 0,gender:"",notes:""}),this.formErrors.set({})}updateFormField(a,e){this.formData.update(s=>T(B({},s),{[a]:e})),this.formErrors()[a]&&this.formErrors.update(s=>{let l=B({},s);return delete l[a],l})}validateForm(){let a={},e=this.formData();return e.name?.trim()||(a.name=this.translate.instant("patient.validation.nameRequired")),e.phone?.trim()?/^[0-9]{10,15}$/.test(e.phone.replace(/\s/g,""))||(a.phone=this.translate.instant("patient.validation.phoneInvalid")):a.phone=this.translate.instant("patient.validation.phoneRequired"),e.age&&(e.age<0||e.age>150)&&(a.age=this.translate.instant("patient.validation.ageInvalid")),this.formErrors.set(a),Object.keys(a).length===0}onSubmitNew(){if(this.validateForm())try{let a=this.formData();this.patientService.createPatient({name:a.name,phone:a.phone,age:a.age,gender:a.gender,notes:a.notes}),this.closeAddModal(),this.showSuccessMessage(this.translate.instant("patient.messages.success.registered"))}catch(a){this.formErrors.update(e=>T(B({},e),{submit:a.message||this.translate.instant("patient.messages.error.createFailed")}))}}onSubmitEdit(){if(!this.validateForm())return;let a=this.selectedPatient();if(a)try{let e=this.formData();if(this.patientService.updatePatient(a.id,{name:e.name,phone:e.phone,age:e.age,gender:e.gender,notes:e.notes}),this.closeEditModal(),this.showDetailsModal()){let s=this.patientService.getPatientById(a.id);s&&this.selectedPatient.set(s)}this.showSuccessMessage(this.translate.instant("patient.messages.success.updated"))}catch(e){this.formErrors.update(s=>T(B({},s),{submit:e.message||this.translate.instant("patient.messages.error.updateFailed")}))}}onDelete(a){let e=this.visitService.getVisitsByPatient(a.id),s=e.length>0?this.translate.instant("patient.messages.confirm.deleteWithVisits",{name:a.name,count:e.length}):this.translate.instant("patient.messages.confirm.deleteWithoutVisits",{name:a.name});if(confirm(s))try{e.forEach(l=>{this.visitService.deleteVisit(l.id)}),this.patientService.deletePatient(a.id),this.selectedPatient()?.id===a.id&&(this.closeDetailsModal(),this.closeEditModal()),this.showSuccessMessage(this.translate.instant("patient.messages.success.deleted"))}catch(l){alert(this.translate.instant("patient.messages.error.deleteFailed",{error:l.message}))}}createVisit(a){try{let e=this.visitService.createVisit(a.id);this.closeDetailsModal(),this.showSuccessMessage(this.translate.instant("patient.messages.success.visitCreated")),this.router.navigate(["/home/visits"])}catch(e){alert(this.translate.instant("patient.messages.error.visitCreateFailed",{error:e.message}))}}viewVisitDetails(a){this.closeDetailsModal(),this.router.navigate(["/home/visits"])}getVisitBalance(a){return this.visitService.getVisitBalance(a)}getVisitStatusColor(a){switch(a){case"waiting":return"bg-yellow-100 text-yellow-800";case"in-progress":return"bg-blue-100 text-blue-800";case"completed":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}getVisitStatusIcon(a){switch(a){case"waiting":return this.ClockIcon;case"in-progress":return this.PlayIcon;case"completed":return this.CheckCircleIcon;default:return this.ClockIcon}}getInitials(a){return a.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2)}formatDate(a){return new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}formatDateTime(a){return new Date(a).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}formatPhone(a){return a.length===11?a.replace(/(\d{4})(\d{3})(\d{4})/,"$1 $2 $3"):a}showSuccessMessage(a){alert("\u2705 "+a)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=L({type:o,selectors:[["app-patient"]],decls:39,vars:35,consts:[[1,"h-full","bg-gray-50"],[1,"bg-white","border-b","border-gray-200","px-8","py-6"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-bold","text-gray-900"],[1,"text-sm","text-gray-500","mt-1"],[1,"flex","items-center","space-x-2","px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[3,"img","size"],[1,"bg-white","border-b","border-gray-200","px-8","py-4"],[1,"flex","items-center","space-x-4"],[1,"flex-1","relative"],[1,"absolute","left-3","top-1/2","transform","-translate-y-1/2","text-gray-400",3,"img","size"],["type","text",1,"w-full","pl-10","pr-10","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value","placeholder"],[1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","text-gray-400","hover:text-gray-600"],[1,"px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"change","value"],["value","date"],["value","name"],["value","visits"],[1,"p-8"],[1,"bg-white","rounded-xl","shadow-sm","border","border-gray-200","overflow-hidden"],[1,"text-center","py-16"],[1,"divide-y","divide-gray-200"],[1,"fixed","inset-0","bg-black","bg-opacity-50","flex","items-center","justify-center","z-50","p-4"],[1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","text-gray-400","hover:text-gray-600",3,"click"],[1,"mx-auto","text-gray-400","mb-4",3,"img","size"],[1,"text-lg","font-semibold","text-gray-900","mb-2"],[1,"text-gray-500","mb-4"],[1,"text-blue-600","hover:text-blue-700","font-medium",3,"click"],[1,"px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[1,"p-6","hover:bg-gray-50","transition-colors","cursor-pointer"],[1,"p-6","hover:bg-gray-50","transition-colors","cursor-pointer",3,"click"],[1,"w-12","h-12","rounded-full","bg-gradient-to-br","from-blue-500","to-purple-600","flex","items-center","justify-center","text-white","font-semibold","text-lg"],[1,"font-semibold","text-gray-900","text-lg"],[1,"flex","items-center","space-x-4","mt-1"],[1,"flex","items-center","text-sm","text-gray-500"],[1,"mr-1",3,"img","size"],[1,"text-sm","text-gray-500"],[1,"text-sm","text-gray-500","capitalize"],[1,"flex","items-start","mt-2","text-sm","text-red-600"],[1,"flex","items-center","space-x-2"],[1,"text-right","mr-4"],[1,"text-sm","font-medium","text-gray-900"],[1,"p-2","text-gray-600","hover:text-blue-600","hover:bg-blue-50","rounded-lg","transition-colors",3,"click","title"],[1,"p-2","text-gray-600","hover:text-red-600","hover:bg-red-50","rounded-lg","transition-colors",3,"click","title"],[1,"mr-1","mt-0.5","flex-shrink-0",3,"img","size"],[1,"line-clamp-1"],[1,"bg-white","rounded-xl","shadow-xl","w-full","max-w-md","max-h-[90vh]","overflow-y-auto"],[1,"flex","items-center","justify-between","p-6","border-b","border-gray-200"],[1,"text-xl","font-bold","text-gray-900"],[1,"text-gray-400","hover:text-gray-600","transition-colors",3,"click"],[1,"p-6","space-y-4",3,"submit"],[1,"block","text-sm","font-medium","text-gray-700","mb-1"],[1,"text-red-500"],["type","text",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value","placeholder"],[1,"mt-1","text-sm","text-red-600"],["type","tel",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value","placeholder"],[1,"grid","grid-cols-2","gap-4"],["type","number","min","0","max","150",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value","placeholder"],[1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"change","value"],["value",""],["value","male"],["value","female"],["rows","3",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value","placeholder"],[1,"p-3","bg-red-50","border","border-red-200","rounded-lg"],[1,"flex","space-x-3","pt-4"],["type","button",1,"flex-1","px-4","py-2","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors","font-medium",3,"click"],["type","submit",1,"flex-1","px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors","font-medium"],[1,"text-sm","text-red-600"],["type","text",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value"],["type","tel",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value"],["type","number","min","0","max","150",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value"],["rows","3",1,"w-full","px-4","py-2","border","border-gray-300","rounded-lg","focus:outline-none","focus:ring-2","focus:ring-blue-500",3,"input","value"],[1,"bg-white","rounded-xl","shadow-xl","w-full","max-w-4xl","max-h-[90vh]","overflow-y-auto"],[1,"p-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6","mb-6"],[1,"bg-gray-50","rounded-lg","p-6"],[1,"font-bold","text-lg","text-gray-900","mb-4"],[1,"space-y-3"],[1,"font-medium","text-gray-900"],[1,"bg-red-50","border","border-red-200","rounded-lg","p-4","mb-6"],[1,"flex","flex-wrap","gap-3","mb-6"],[1,"flex","items-center","space-x-2","px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-colors",3,"click"],[1,"flex","items-center","space-x-2","px-4","py-2","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors",3,"click"],[1,"flex","items-center","space-x-2","px-4","py-2","border","border-red-300","text-red-600","rounded-lg","hover:bg-red-50","transition-colors","ml-auto",3,"click"],[1,"pt-6","border-t","border-gray-200"],[1,"text-center","py-12","bg-gray-50","rounded-lg"],[1,"font-medium","text-gray-900","capitalize"],[1,"flex","justify-between","items-center"],[1,"font-bold","text-lg","text-gray-900"],[1,"font-bold","text-lg","text-green-600"],[1,"font-bold","text-lg","text-red-600"],[1,"pt-3","border-t","border-gray-200"],[1,"flex","items-start"],[1,"text-red-600","mr-2","mt-0.5","flex-shrink-0",3,"img","size"],[1,"font-semibold","text-red-900","mb-1"],[1,"text-sm","text-red-800"],[1,"mx-auto","mb-3","text-gray-400",3,"img","size"],[1,"text-gray-600","font-medium","mb-2"],[1,"text-sm","text-gray-500","mb-4"],[1,"px-4","py-2","bg-green-600","text-white","rounded-lg","hover:bg-green-700","transition-colors",3,"click"],[1,"border","border-gray-200","rounded-lg","p-4","hover:bg-gray-50","transition-colors","cursor-pointer"],[1,"border","border-gray-200","rounded-lg","p-4","hover:bg-gray-50","transition-colors","cursor-pointer",3,"click"],[1,"flex","items-center","justify-between","mb-3"],[1,"flex","items-center","space-x-3"],[1,"w-10","h-10","rounded-full","bg-gradient-to-br","from-blue-500","to-purple-600","flex","items-center","justify-center"],[1,"text-white",3,"img","size"],[1,"flex","items-center","space-x-2","mb-1"],[1,"text-sm","text-gray-700","line-clamp-1"],[1,"text-right"],[1,"text-lg","font-bold","text-gray-900"],[1,"text-sm","font-medium","text-red-600"],[1,"text-sm","font-medium","text-green-600"],[1,"flex","items-center","space-x-4","text-xs","text-gray-500","pt-3","border-t","border-gray-100"],[1,"flex","items-center"]],template:function(e,s){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div")(4,"h1",3),r(5),d(6,"translate"),n(),i(7,"p",4),r(8),d(9,"translate"),n()(),i(10,"button",5),_("click",function(){return s.openAddModal()}),b(11,"lucide-icon",6),i(12,"span"),r(13),d(14,"translate"),n()()()(),i(15,"div",7)(16,"div",8)(17,"div",9),b(18,"lucide-icon",10),i(19,"input",11),d(20,"translate"),_("input",function(u){return s.onSearch(u)}),n(),f(21,Se,2,2,"button",12),n(),i(22,"select",13),_("change",function(u){return s.setSortBy(u.target.value)}),i(23,"option",14),r(24),d(25,"translate"),n(),i(26,"option",15),r(27),d(28,"translate"),n(),i(29,"option",16),r(30),d(31,"translate"),n()()()(),i(32,"div",17)(33,"div",18),f(34,we,4,3,"div",19)(35,De,3,0,"div",20),n()()(),f(36,Ne,66,68,"div",21),f(37,$e,61,53,"div",21),f(38,tt,66,48,"div",21)),e&2&&(t(5),c(p(6,18,"patient.title")),t(3),h(" ",O(9,20,s.filteredPatients().length===1?"patient.subtitle":"patient.subtitle_plural",A(33,be,s.filteredPatients().length))," "),t(3),x("img",s.PlusIcon)("size",20),t(2),c(p(14,23,"patient.buttons.newPatient")),t(5),x("img",s.SearchIcon)("size",20),t(),x("value",s.searchQuery())("placeholder",p(20,25,"patient.search.placeholder")),t(2),C(s.searchQuery()?21:-1),t(),x("value",s.sortBy()),t(2),c(p(25,27,"patient.sort.mostRecent")),t(3),c(p(28,29,"patient.sort.nameAZ")),t(3),c(p(31,31,"patient.sort.mostVisits")),t(4),C(s.filteredPatients().length===0?34:35),t(2),C(s.showAddModal()?36:-1),t(),C(s.showEditModal()&&s.selectedPatient()?37:-1),t(),C(s.showDetailsModal()&&s.selectedPatient()?38:-1))},dependencies:[j,xe,ce,me,ue,de,pe,se,le,X,U],encapsulation:2})};export{ge as PatientComponent};
