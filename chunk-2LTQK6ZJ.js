import{b as Z,c as ee,f as te,i as ie,j as ne,k as ae,n as re}from"./chunk-H6JEJQHG.js";import{a as de}from"./chunk-FNZ3CGE5.js";import{a as oe}from"./chunk-TNVVAGLP.js";import{G as q,J as K,L as Q,M as X,c as G,g as L,j as $,l as Y,m as z,n as H,o as J}from"./chunk-ESOQDHF6.js";import{Aa as k,Gb as O,Ib as B,Jb as A,Kb as W,La as _,Ma as C,Oa as D,Pa as w,Qa as p,Ra as i,S as f,Sa as n,T as S,Ta as u,Ua as F,Va as E,Wa as y,_a as N,a as I,ba as b,bb as d,cb as c,db as R,gb as M,hb as P,ib as T,pa as o,qb as j,rb as v,tb as U,ub as h,wa as V,wb as x}from"./chunk-KIKRUHUI.js";var se=(s,a,e)=>({"bg-blue-600":s,"bg-green-600":a,"bg-purple-600":e}),me=(s,a)=>a.method,ce=(s,a)=>a.date,pe=(s,a)=>a.name,ue=(s,a)=>a.id;function ge(s,a){if(s&1){let e=F();i(0,"div",17)(1,"input",46),T("ngModelChange",function(r){f(e);let l=y();return P(l.customStartDate,r)||(l.customStartDate=r),S(r)}),E("change",function(){f(e);let r=y();return S(r.onCustomDateChange())}),n(),i(2,"span",47),d(3,"to"),n(),i(4,"input",46),T("ngModelChange",function(r){f(e);let l=y();return P(l.customEndDate,r)||(l.customEndDate=r),S(r)}),E("change",function(){f(e);let r=y();return S(r.onCustomDateChange())}),n()()}if(s&2){let e=y();o(),M("ngModel",e.customStartDate),o(3),M("ngModel",e.customEndDate)}}function ve(s,a){if(s&1&&(i(0,"div")(1,"div",48)(2,"span",49),d(3),n(),i(4,"span",50),d(5),v(6,"currency"),n()(),i(7,"div",51),u(8,"div",52),n()()),s&2){let e=a.$implicit;o(3),c(e.method),o(2),c(h(6,5,e.amount,"EGP","symbol","1.0-0")),o(3),N("width",e.percentage,"%"),p("ngClass",j(10,se,e.method==="cash",e.method==="visa",e.method==="bank"))}}function xe(s,a){if(s&1&&(i(0,"span",56),d(1),v(2,"currency"),n()),s&2){let e=y().$implicit;o(),c(h(2,1,e.amount,"EGP","symbol","1.0-0"))}}function he(s,a){if(s&1&&(i(0,"div",3)(1,"span",53),d(2),n(),i(3,"div",54)(4,"div",55),_(5,xe,3,6,"span",56),n()()()),s&2){let e=a.$implicit;o(2),c(e.date),o(2),N("width",e.percentage,"%"),o(),C(e.amount>0?5:-1)}}function ye(s,a){if(s&1&&(i(0,"tr",43)(1,"td",57),d(2),n(),i(3,"td",58),d(4),n(),i(5,"td",59),d(6),v(7,"currency"),n()()),s&2){let e=a.$implicit;o(2),c(e.name),o(2),c(e.count),o(2),R(" ",h(7,3,e.revenue,"EGP","symbol","1.0-0")," ")}}function fe(s,a){s&1&&(i(0,"tr")(1,"td",60),d(2,"No procedures recorded"),n()())}function Se(s,a){if(s&1&&(i(0,"div",44)(1,"div")(2,"p",61),d(3),n(),i(4,"p",62),d(5),v(6,"date"),n()(),i(7,"div",63)(8,"p",64),d(9),v(10,"currency"),n(),i(11,"p",62),d(12),v(13,"currency"),n()()()),s&2){let e=a.$implicit;o(3),c(e.patientName||"Unknown Patient"),o(2),c(U(6,4,e.date,"MMM d, y")),o(4),c(h(10,7,e.balance,"EGP","symbol","1.0-0")),o(3),R("of ",h(13,12,e.totalCost,"EGP","symbol","1.0-0"))}}function be(s,a){s&1&&(i(0,"p",45),d(1,"All visits are paid!"),n())}var le=class s{constructor(a,e){this.visitService=a;this.patientService=e}TrendingUp=q;DollarSign=Y;Users=K;Calendar=G;FileText=H;Download=z;Filter=J;CreditCard=$;AlertCircle=L;selectedPeriod=b("month");customStartDate=b("");customEndDate=b("");dateRange=b(this.getDateRange("month"));financialStats=x(()=>this.visitService.getFinancialSummary());totalPatients=x(()=>this.patientService.getAllPatients().length);periodStats=x(()=>{let a=this.dateRange(),e=this.visitService.visits().filter(r=>{let l=new Date(r.date);return l>=a.start&&l<=a.end}),t=this.visitService.payments().filter(r=>{let l=new Date(r.date);return l>=a.start&&l<=a.end});return{totalVisits:e.length,totalRevenue:t.reduce((r,l)=>r+l.amount,0)}});paymentMethodsData=x(()=>{let a=this.dateRange(),e=this.visitService.payments().filter(l=>{let m=new Date(l.date);return m>=a.start&&m<=a.end}),t=e.reduce((l,m)=>l+m.amount,0),r={};return e.forEach(l=>{r[l.method]=(r[l.method]||0)+l.amount}),Object.entries(r).map(([l,m])=>({method:l,amount:m,percentage:t>0?m/t*100:0}))});revenueTrend=x(()=>{let a=this.dateRange(),e=[],t={};this.visitService.payments().filter(m=>{let g=new Date(m.date);return g>=a.start&&g<=a.end}).forEach(m=>{let g=new Date(m.date).toLocaleDateString("en-US",{month:"short",day:"numeric"});t[g]=(t[g]||0)+m.amount});let l=Math.max(...Object.values(t),1);return Object.entries(t).sort((m,g)=>new Date(m[0]).getTime()-new Date(g[0]).getTime()).slice(-7).forEach(([m,g])=>{e.push({date:m,amount:g,percentage:g/l*100})}),e});topProcedures=x(()=>{let a=this.dateRange(),e=this.visitService.procedures().filter(r=>{let l=new Date(r.date);return l>=a.start&&l<=a.end}),t={};return e.forEach(r=>{t[r.name]||(t[r.name]={count:0,revenue:0}),t[r.name].count++,t[r.name].revenue+=r.price}),Object.entries(t).map(([r,l])=>I({name:r},l)).sort((r,l)=>l.revenue-r.revenue).slice(0,5)});unpaidVisits=x(()=>this.visitService.getUnpaidVisits().map(e=>this.visitService.getVisitWithDetails(e.id,this.patientService)).filter(e=>e!==null).slice(0,5));revenueGrowth=x(()=>12.5);onPeriodChange(){this.dateRange.set(this.getDateRange(this.selectedPeriod()))}onCustomDateChange(){this.customStartDate()&&this.customEndDate()&&this.dateRange.set({start:new Date(this.customStartDate()),end:new Date(this.customEndDate())})}getDateRange(a){let e=new Date,t=new Date;switch(a){case"today":t.setHours(0,0,0,0);break;case"week":t.setDate(e.getDate()-7);break;case"month":t.setMonth(e.getMonth()-1);break;case"year":t.setFullYear(e.getFullYear()-1);break}return{start:t,end:e}}exportReport(){let a={generatedAt:new Date().toISOString(),period:this.selectedPeriod(),dateRange:this.dateRange(),summary:{financial:this.financialStats(),period:this.periodStats(),totalPatients:this.totalPatients()},paymentMethods:this.paymentMethodsData(),topProcedures:this.topProcedures(),unpaidVisits:this.unpaidVisits()},e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=`clinic-report-${new Date().toISOString().split("T")[0]}.json`,r.click(),URL.revokeObjectURL(t)}static \u0275fac=function(e){return new(e||s)(V(oe),V(de))};static \u0275cmp=k({type:s,selectors:[["app-report"]],decls:102,vars:28,consts:[[1,"min-h-screen","bg-gray-50","p-6"],[1,"max-w-7xl","mx-auto"],[1,"flex","items-center","justify-between","mb-8"],[1,"flex","items-center","gap-3"],[1,"w-8","h-8","text-blue-600",3,"img"],[1,"text-3xl","font-bold","text-gray-900"],[1,"flex","items-center","gap-2","px-4","py-2","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[1,"w-4","h-4",3,"img"],[1,"bg-white","rounded-lg","shadow-sm","p-6","mb-6"],[1,"flex","items-center","gap-4","flex-wrap"],[1,"w-5","h-5","text-gray-600",3,"img"],[1,"px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500","focus:border-transparent",3,"ngModelChange","change","ngModel"],["value","today"],["value","week"],["value","month"],["value","year"],["value","custom"],[1,"flex","items-center","gap-2"],[1,"grid","grid-cols-1","md:grid-cols-2","lg:grid-cols-4","gap-6","mb-8"],[1,"bg-white","rounded-lg","shadow-sm","p-6"],[1,"flex","items-center","justify-between","mb-4"],[1,"p-3","bg-green-100","rounded-lg"],[1,"w-6","h-6","text-green-600",3,"img"],[1,"text-sm","text-green-600","font-medium"],[1,"text-gray-600","text-sm","font-medium","mb-1"],[1,"text-2xl","font-bold","text-gray-900"],[1,"p-3","bg-blue-100","rounded-lg"],[1,"w-6","h-6","text-blue-600",3,"img"],[1,"p-3","bg-purple-100","rounded-lg"],[1,"w-6","h-6","text-purple-600",3,"img"],[1,"p-3","bg-red-100","rounded-lg"],[1,"w-6","h-6","text-red-600",3,"img"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6","mb-8"],[1,"text-lg","font-semibold","text-gray-900","mb-6","flex","items-center","gap-2"],[1,"space-y-4"],[1,"space-y-3"],[1,"grid","grid-cols-1","lg:grid-cols-2","gap-6"],[1,"text-lg","font-semibold","text-gray-900","mb-4"],[1,"overflow-x-auto"],[1,"w-full"],[1,"border-b","border-gray-200"],[1,"text-left","py-3","px-4","text-sm","font-medium","text-gray-600"],[1,"text-right","py-3","px-4","text-sm","font-medium","text-gray-600"],[1,"border-b","border-gray-100"],[1,"flex","items-center","justify-between","p-3","bg-gray-50","rounded-lg"],[1,"text-center","text-gray-500","py-8"],["type","date",1,"px-4","py-2","border","border-gray-300","rounded-lg","focus:ring-2","focus:ring-blue-500",3,"ngModelChange","change","ngModel"],[1,"text-gray-500"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-medium","text-gray-700","capitalize"],[1,"text-sm","font-semibold","text-gray-900"],[1,"w-full","bg-gray-200","rounded-full","h-2"],[1,"h-2","rounded-full","transition-all","duration-300",3,"ngClass"],[1,"text-xs","text-gray-600","w-20"],[1,"flex-1","bg-gray-200","rounded-full","h-8","relative"],[1,"bg-gradient-to-r","from-blue-500","to-blue-600","h-8","rounded-full","flex","items-center","justify-end","pr-3","transition-all","duration-300"],[1,"text-xs","font-medium","text-white"],[1,"py-3","px-4","text-sm","text-gray-900"],[1,"py-3","px-4","text-sm","text-gray-600","text-right"],[1,"py-3","px-4","text-sm","font-medium","text-gray-900","text-right"],["colspan","3",1,"py-8","text-center","text-gray-500"],[1,"text-sm","font-medium","text-gray-900"],[1,"text-xs","text-gray-600"],[1,"text-right"],[1,"text-sm","font-semibold","text-red-600"]],template:function(e,t){e&1&&(i(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),u(4,"lucide-icon",4),i(5,"h1",5),d(6,"Reports & Analytics"),n()(),i(7,"button",6),E("click",function(){return t.exportReport()}),u(8,"lucide-icon",7),d(9," Export Report "),n()(),i(10,"div",8)(11,"div",9),u(12,"lucide-icon",10),i(13,"select",11),T("ngModelChange",function(l){return P(t.selectedPeriod,l)||(t.selectedPeriod=l),l}),E("change",function(){return t.onPeriodChange()}),i(14,"option",12),d(15,"Today"),n(),i(16,"option",13),d(17,"This Week"),n(),i(18,"option",14),d(19,"This Month"),n(),i(20,"option",15),d(21,"This Year"),n(),i(22,"option",16),d(23,"Custom Range"),n()(),_(24,ge,5,2,"div",17),n()(),i(25,"div",18)(26,"div",19)(27,"div",20)(28,"div",21),u(29,"lucide-icon",22),n(),i(30,"span",23),d(31),n()(),i(32,"h3",24),d(33,"Total Revenue"),n(),i(34,"p",25),d(35),v(36,"currency"),n()(),i(37,"div",19)(38,"div",20)(39,"div",26),u(40,"lucide-icon",27),n()(),i(41,"h3",24),d(42,"Total Visits"),n(),i(43,"p",25),d(44),n()(),i(45,"div",19)(46,"div",20)(47,"div",28),u(48,"lucide-icon",29),n()(),i(49,"h3",24),d(50,"Total Patients"),n(),i(51,"p",25),d(52),n()(),i(53,"div",19)(54,"div",20)(55,"div",30),u(56,"lucide-icon",31),n()(),i(57,"h3",24),d(58,"Outstanding"),n(),i(59,"p",25),d(60),v(61,"currency"),n()()(),i(62,"div",32)(63,"div",19)(64,"h2",33),u(65,"lucide-icon",10),d(66," Payment Methods "),n(),i(67,"div",34),D(68,ve,9,14,"div",null,me),n()(),i(70,"div",19)(71,"h2",33),u(72,"lucide-icon",10),d(73," Revenue Trend "),n(),i(74,"div",35),D(75,he,6,4,"div",3,ce),n()()(),i(77,"div",36)(78,"div",19)(79,"h2",37),d(80,"Top Procedures"),n(),i(81,"div",38)(82,"table",39)(83,"thead")(84,"tr",40)(85,"th",41),d(86,"Procedure"),n(),i(87,"th",42),d(88,"Count"),n(),i(89,"th",42),d(90,"Revenue"),n()()(),i(91,"tbody"),D(92,ye,8,8,"tr",43,pe),_(94,fe,3,0,"tr"),n()()()(),i(95,"div",19)(96,"h2",37),d(97,"Recent Unpaid Visits"),n(),i(98,"div",35),D(99,Se,14,17,"div",44,ue),_(101,be,2,0,"p",45),n()()()()()),e&2&&(o(4),p("img",t.FileText),o(4),p("img",t.Download),o(4),p("img",t.Filter),o(),M("ngModel",t.selectedPeriod),o(11),C(t.selectedPeriod()==="custom"?24:-1),o(5),p("img",t.DollarSign),o(2),R("+",t.revenueGrowth(),"%"),o(4),c(h(36,18,t.financialStats().totalRevenue,"EGP","symbol","1.0-0")),o(5),p("img",t.Calendar),o(4),c(t.periodStats().totalVisits),o(4),p("img",t.Users),o(4),c(t.totalPatients()),o(4),p("img",t.AlertCircle),o(4),R("",h(61,23,t.financialStats().totalOwed,"EGP","symbol","1.0-0")," "),o(5),p("img",t.CreditCard),o(3),w(t.paymentMethodsData()),o(4),p("img",t.TrendingUp),o(3),w(t.revenueTrend()),o(17),w(t.topProcedures()),o(2),C(t.topProcedures().length===0?94:-1),o(5),w(t.unpaidVisits()),o(2),C(t.unpaidVisits().length===0?101:-1))},dependencies:[X,Q,W,O,re,ne,ae,Z,ie,ee,te,A,B],encapsulation:2})};export{le as ReportComponent};
